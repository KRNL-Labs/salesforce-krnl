{
  "chain_id": 11155111,
  "sender": "{{ENV.SENDER_ADDRESS}}",
  "delegate": "{{TRANSACTION_INTENT_DELEGATE}}",
  "attestor": "{{ENV.ATTESTOR_ADDRESS}}",
  "target": {
    "contract": "{{ENV.DOCUMENT_REGISTRY_CONTRACT}}",
    "function": "registerDocumentKRNL((uint256,uint256,bytes32,(bytes32,bytes,bytes)[],bytes,bool,bytes))",
    "authData_result": "${prepare-document-metadata.result}"
  },
  "sponsor_execution_fee": true,
  "value": "0",
  "intent": {
    "id": "{{TRANSACTION_INTENT_ID}}",
    "signature": "{{USER_SIGNATURE}}",
    "deadline": "{{TRANSACTION_INTENT_DEADLINE}}"
  },
  "rpc_url": "${_SECRETS.rpcSepoliaURL}",
  "bundler_url": "https://api.pimlico.io/v2/sepolia/rpc?apikey=${_SECRETS.pimlico-apikey}",
  "paymaster_url": "https://api.pimlico.io/v2/sepolia/rpc?apikey=${_SECRETS.pimlico-apikey}",
  "gas_limit": "200000",
  "max_fee_per_gas": "20000000000",
  "max_priority_fee_per_gas": "2000000000",
  "workflow": {
    "name": "salesforce-document-registration",
    "version": "v1.0.0",
    "steps": [
      {
        "name": "fetch-salesforce-document",
        "image": "ghcr.io/krnl-labs/executor-http@sha256:07ef35b261014304a0163502a7f1dec5395c5cac1fc381dc1f79b052389ab0d5",
        "attestor": "{{ENV.ATTESTOR_ADDRESS}}",
        "next": "prepare-document-metadata",
        "inputs": {
          "url": "{{SALESFORCE_INSTANCE_URL}}/services/data/v59.0/sobjects/ContentDocument/{{DOCUMENT_ID}}",
          "method": "GET",
          "headers": {
            "Authorization": "Bearer {{SALESFORCE_ACCESS_TOKEN}}",
            "Accept": "application/json",
            "Content-Type": "application/json"
          },
          "timeout": 30
        },
        "outputs": [
          {
            "name": "documentId",
            "value": "response.body.Id",
            "required": true,
            "export": true
          },
          {
            "name": "title",
            "value": "response.body.Title",
            "required": true,
            "export": true
          },
          {
            "name": "fileType",
            "value": "response.body.FileType",
            "required": true,
            "export": true
          },
          {
            "name": "contentSize",
            "value": "response.body.ContentSize",
            "required": true,
            "export": true
          },
          {
            "name": "createdDate",
            "value": "response.body.CreatedDate",
            "required": true,
            "export": true
          },
          {
            "name": "ownerId",
            "value": "response.body.OwnerId",
            "required": true,
            "export": true
          }
        ]
      },
      {
        "name": "prepare-document-metadata",
        "image": "ghcr.io/krnl-labs/executor-encoder-evm@sha256:b28823d12eb1b16cbcc34c751302cd2dbe7e35480a5bc20e4e7ad50a059b6611",
        "attestor": "{{ENV.ATTESTOR_ADDRESS}}",
        "config": {
          "parameters": [
            {
              "name": "documentHash",
              "type": "string"
            },
            {
              "name": "metadata",
              "type": "string"
            },
            {
              "name": "salesforceRecordId",
              "type": "string"
            }
          ]
        },
        "inputs": {
          "documentHash": "{{DOCUMENT_HASH}}",
          "metadata": {
            "title": "${fetch-salesforce-document.title}",
            "fileType": "${fetch-salesforce-document.fileType}",
            "contentSize": "${fetch-salesforce-document.contentSize}",
            "createdDate": "${fetch-salesforce-document.createdDate}",
            "ownerId": "${fetch-salesforce-document.ownerId}",
            "platform": "Salesforce",
            "registrationTimestamp": "{{CURRENT_TIMESTAMP}}",
            "version": "1.0"
          },
          "salesforceRecordId": "${fetch-salesforce-document.documentId}"
        },
        "outputs": [
          {
            "name": "result",
            "value": "encoded_data",
            "required": true,
            "export": true
          }
        ]
      }
    ]
  }
}
